<div class="container mx-auto px-4 py-8">
  <h1 class="text-2xl font-semibold mb-6">Knowledge Base Files</h1>

  <div class="bg-white shadow rounded-lg p-6 mb-8">
    <h2 class="text-xl font-medium mb-4">Upload New File</h2>
    <%= form_with(model: @new_file_upload, url: knowledge_base_index_path, class: "space-y-4") do |form| %>
      <% if @new_file_upload.errors.any? %>
        <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative" role="alert">
          <strong class="font-bold">Oops!</strong>
          <span class="block sm:inline"><%= pluralize(@new_file_upload.errors.count, "error") %> prohibited this file from being saved:</span>
          <ul class="list-disc pl-5 mt-2">
            <% @new_file_upload.errors.full_messages.each do |message| %>
              <li><%= message %></li>
            <% end %>
          </ul>
        </div>
      <% end %>

      <div>
        <%= form.label :file, class: "block text-sm font-medium text-gray-700" %>
        <div class="mt-1">
          <%= form.file_field :file, class: "block w-full text-sm text-gray-900 border border-gray-300 rounded-lg cursor-pointer bg-gray-50 focus:outline-none" %>
        </div>
        <p class="mt-1 text-sm text-gray-500">Upload documents (PDF, Word, etc.) to build the knowledge base.</p>
      </div>

      <div>
        <%= form.submit "Upload File", class: "inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 cursor-pointer" %>
      </div>
    <% end %>
  </div>

  <div class="bg-white shadow rounded-lg overflow-hidden">
    <table class="min-w-full divide-y divide-gray-200">
      <thead class="bg-gray-50">
        <tr>
          <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Filename</th>
          <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Uploaded By</th>
          <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Uploaded At</th>
          <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
          <th scope="col" class="relative px-6 py-3">
            <span class="sr-only">Actions</span>
          </th>
        </tr>
      </thead>
      <tbody class="bg-white divide-y divide-gray-200">
        <% @file_uploads.each do |file_upload| %>
          <tr>
            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
              <%= file_upload.file.filename if file_upload.file.attached? %>
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
              <%= file_upload.user.email %>
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
              <%= time_ago_in_words(file_upload.created_at) %> ago
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
              <% if file_upload.processed_at? %>
                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">
                  Processed
                </span>
              <% else %>
                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800">
                  Processing
                </span>
              <% end %>
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
              <%# Add actions like delete here if needed %>
            </td>
          </tr>
        <% end %>
        <% if @file_uploads.empty? %>
          <tr>
            <td colspan="5" class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-center">No files uploaded yet.</td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
</div>
